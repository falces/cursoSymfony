<?php

namespace App\Tests\Service;

use App\Service\FileUploader;
use League\Flysystem\FilesystemException;
use League\Flysystem\FilesystemOperator;
use PHPUnit\Framework\MockObject\MockObject;
use PHPUnit\Framework\TestCase;

class FileUploaderUnitTest extends TestCase
{
    /**
     * @throws FilesystemException
     */
    public function testUploadBase64File()
    {
        $base64Image = "data:image/jpeg;base64,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";

        $data = explode(',', $base64Image);

        /** @var FilesystemOperator&MockObject $filesystem */
        $filesystem = $this
            ->getMockBuilder(FilesystemOperator::class)
            ->disableOriginalConstructor()
            ->getMock();
        $filesystem
            ->expects(self::exactly(1))
            ->method('write')
            ->with($this->isType('string'), base64_decode($data[1]));

        $fileUploader = new FileUploader($filesystem);
        $filename = $fileUploader->uploadBase64File($base64Image);

        $this->assertNotEmpty($filename);
        $this->assertStringContainsString('.jpeg', $filename);
    }
}